# CIæµ‹è¯•å¥—ä»¶

è¿™æ˜¯ä¸ºSonicInputé¡¹ç›®ä¸“é—¨è®¾è®¡çš„CIï¼ˆæŒç»­é›†æˆï¼‰æµ‹è¯•å¥—ä»¶ï¼Œä¸“é—¨ç”¨äºåœ¨CIç¯å¢ƒä¸­è¿è¡Œï¼Œé¿å…äº†å¯¹GUIã€GPUã€çœŸå®API keyå’Œç¡¬ä»¶è®¾å¤‡çš„ä¾èµ–ã€‚

## ğŸ¯ è®¾è®¡ç›®æ ‡

1. **æ— å¤–éƒ¨ä¾èµ–** - ä¸éœ€è¦çœŸå®API keyã€GPUæˆ–éŸ³é¢‘è®¾å¤‡
2. **å¿«é€Ÿæ‰§è¡Œ** - æµ‹è¯•åœ¨30ç§’å†…å®Œæˆ
3. **ç¨³å®šå¯é ** - MockåŒ–æ‰€æœ‰å¤–éƒ¨æœåŠ¡
4. **è½»é‡çº§** - æœ€å°åŒ–èµ„æºå ç”¨
5. **CIå‹å¥½** - è‡ªåŠ¨ç¯å¢ƒæ£€æµ‹å’Œé…ç½®

## ğŸ“ æ–‡ä»¶ç»“æ„

```
tests/ci/
â”œâ”€â”€ conftest.py                 # CIç¯å¢ƒå’Œ fixtures é…ç½®
â”œâ”€â”€ pytest.ini                 # pytest ä¸“ç”¨é…ç½®
â”œâ”€â”€ run_ci_tests.py            # CI æµ‹è¯•è¿è¡Œå™¨
â”œâ”€â”€ README.md                  # æœ¬æ–‡ä»¶
â”œâ”€â”€ unit/                      # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ test_basic_simple.py   # åŸºç¡€åŠŸèƒ½æµ‹è¯•
â”‚   â”œâ”€â”€ test_core_services.py  # æ ¸å¿ƒæœåŠ¡æµ‹è¯•
â”‚   â””â”€â”€ test_refactoring_completeness.py  # é‡æ„éªŒè¯æµ‹è¯•
â”œâ”€â”€ integration/               # é›†æˆæµ‹è¯•ï¼ˆä½¿ç”¨Mockï¼‰
â”‚   â”œâ”€â”€ test_cloud_services_light.py  # äº‘æœåŠ¡è½»é‡çº§æµ‹è¯•
â”‚   â””â”€â”€ [æ›´å¤šé›†æˆæµ‹è¯•]
â””â”€â”€ reports/                   # æµ‹è¯•æŠ¥å‘Šç›®å½•ï¼ˆè¿è¡Œæ—¶åˆ›å»ºï¼‰
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### å¿«é€Ÿæµ‹è¯•
```bash
cd tests/ci
uv run python run_ci_tests.py --quick
```

### è¿è¡Œæ‰€æœ‰æµ‹è¯•
```bash
cd tests/ci
uv run python run_ci_tests.py
```

### åªè¿è¡Œå•å…ƒæµ‹è¯•
```bash
cd tests/ci
uv run python run_ci_tests.py --unit-only
```

### åªè¿è¡Œé›†æˆæµ‹è¯•
```bash
cd tests/ci
uv run python run_ci_tests.py --integration-only
```

### ä½¿ç”¨pytestç›´æ¥è¿è¡Œ
```bash
cd tests/ci
uv run pytest -v -m "unit"
uv run pytest -v -m "integration"
```

## ğŸ·ï¸ æµ‹è¯•æ ‡è®°

- `@pytest.mark.ci` - CIç¯å¢ƒæ ‡è®°
- `@pytest.mark.unit` - å•å…ƒæµ‹è¯•ï¼ˆæ— å¤–éƒ¨ä¾èµ–ï¼‰
- `@pytest.mark.integration` - é›†æˆæµ‹è¯•ï¼ˆä½¿ç”¨Mockï¼‰
- `@pytest.mark.slow` - æ…¢é€Ÿæµ‹è¯•ï¼ˆåœ¨CIä¸­è·³è¿‡ï¼‰
- `@pytest.mark.gpu` - éœ€è¦GPUçš„æµ‹è¯•ï¼ˆåœ¨CIä¸­è·³è¿‡ï¼‰
- `@pytest.mark.gui` - éœ€è¦GUIçš„æµ‹è¯•ï¼ˆåœ¨CIä¸­è·³è¿‡ï¼‰

## ğŸ§ª æµ‹è¯•è¦†ç›–èŒƒå›´

### å•å…ƒæµ‹è¯•
- âœ… DIå®¹å™¨åŸºç¡€åŠŸèƒ½
- âœ… äº‹ä»¶ç³»ç»Ÿå¸¸é‡å’ŒåŸºç¡€æ“ä½œ
- âœ… çŠ¶æ€ç®¡ç†æšä¸¾
- âœ… MockæœåŠ¡æ¥å£
- âœ… é‡æ„å®Œæ•´æ€§éªŒè¯

### é›†æˆæµ‹è¯•
- âœ… äº‘æœåŠ¡å·¥å‚æ¨¡å¼ï¼ˆå®Œå…¨MockåŒ–ï¼‰
- âœ… é…ç½®é©±åŠ¨çš„æœåŠ¡åˆ›å»º
- âœ… é”™è¯¯å¤„ç†å’Œå›é€€æœºåˆ¶
- âœ… æœåŠ¡æ¥å£å…¼å®¹æ€§

## ğŸ”„ CIç¯å¢ƒè‡ªåŠ¨æ£€æµ‹

è„šæœ¬ä¼šè‡ªåŠ¨æ£€æµ‹ä»¥ä¸‹CIç¯å¢ƒï¼š
- GitHub Actions
- GitLab CI
- Travis CI
- AppVeyor
- Jenkins
- CircleCI

åœ¨CIç¯å¢ƒä¸­ä¼šï¼š
- è‡ªåŠ¨è·³è¿‡æ…¢é€Ÿã€GPUã€GUIæµ‹è¯•
- ç”ŸæˆXMLå’ŒHTMLæµ‹è¯•æŠ¥å‘Š
- ä½¿ç”¨è¾ƒçŸ­çš„è¶…æ—¶æ—¶é—´
- å‡å°‘æ—¥å¿—è¾“å‡º

## ğŸ“Š æµ‹è¯•æŠ¥å‘Š

åœ¨CIç¯å¢ƒä¸­ï¼Œæµ‹è¯•æŠ¥å‘Šä¼šç”Ÿæˆåœ¨ `reports/` ç›®å½•ï¼š
- `unit-tests.xml` - JUnitæ ¼å¼çš„å•å…ƒæµ‹è¯•æŠ¥å‘Š
- `integration-tests.xml` - JUnitæ ¼å¼çš„é›†æˆæµ‹è¯•æŠ¥å‘Š
- `ci-summary.txt` - CIæµ‹è¯•æ±‡æ€»
- `*.html` - HTMLæ ¼å¼çš„è¯¦ç»†æŠ¥å‘Š

## ğŸ› ï¸ æœ¬åœ°å¼€å‘

### å®‰è£…ä¾èµ–
```bash
uv sync
```

### è¿è¡Œç‰¹å®šæµ‹è¯•
```bash
# åªè¿è¡ŒåŸºç¡€æµ‹è¯•
uv run pytest tests/ci/unit/test_basic_simple.py -v

# è¿è¡Œæ ¸å¿ƒæœåŠ¡æµ‹è¯•
uv run pytest tests/ci/unit/test_core_services.py -v

# è¿è¡Œäº‘æœåŠ¡æµ‹è¯•
uv run pytest tests/ci/integration/test_cloud_services_light.py -v
```

### è°ƒè¯•å¤±è´¥çš„æµ‹è¯•
```bash
# è¯¦ç»†è¾“å‡º
uv run pytest tests/ci/ -v -s

# åœåœ¨ç¬¬ä¸€ä¸ªå¤±è´¥
uv run pytest tests/ci/ -x

# åªè¿è¡Œä¸Šæ¬¡å¤±è´¥çš„æµ‹è¯•
uv run pytest tests/ci/ --lf
```

## ğŸ›ï¸ é…ç½®é€‰é¡¹

### ç¯å¢ƒå˜é‡
- `CI=1` - å¼ºåˆ¶å¯ç”¨CIæ¨¡å¼
- `GITHUB_ACTIONS=1` - GitHub Actionsæ¨¡å¼

### é…ç½®æ–‡ä»¶
- `pytest.ini` - pytesté…ç½®
- `conftest.py` - fixtureså’Œè‡ªåŠ¨é…ç½®

## ğŸš« ä¸é€‚åˆCIçš„æµ‹è¯•

ä»¥ä¸‹ç±»å‹çš„æµ‹è¯•**ä¸**åŒ…å«åœ¨CIå¥—ä»¶ä¸­ï¼š
- ğŸ–¥ï¸ GUIç»„ä»¶æµ‹è¯•ï¼ˆéœ€è¦PySide6/Qtç¯å¢ƒï¼‰
- ğŸ¤ çœŸå®éŸ³é¢‘è®¾å¤‡æµ‹è¯•ï¼ˆéœ€è¦éº¦å…‹é£ï¼‰
- ğŸ–¥ï¸ GPUåŠ é€Ÿæµ‹è¯•ï¼ˆéœ€è¦CUDAï¼‰
- ğŸ”‘ çœŸå®APIè°ƒç”¨æµ‹è¯•ï¼ˆéœ€è¦API keyï¼‰
- ğŸŒ æ…¢é€Ÿç«¯åˆ°ç«¯æµ‹è¯•ï¼ˆè€—æ—¶è¿‡é•¿ï¼‰

è¿™äº›æµ‹è¯•ä»åœ¨ä¸» `tests/` ç›®å½•ä¸­ï¼Œå¯ä»¥åœ¨æœ¬åœ°æˆ–ä¸“ç”¨ç¯å¢ƒä¸­è¿è¡Œã€‚

## ğŸ”„ ä¸ä¸»æµ‹è¯•å¥—ä»¶çš„å…³ç³»

CIæµ‹è¯•å¥—ä»¶æ˜¯ä¸»æµ‹è¯•å¥—ä»¶çš„å­é›†ï¼š
- ä¸“æ³¨äºæ ¸å¿ƒä¸šåŠ¡é€»è¾‘
- MockåŒ–æ‰€æœ‰å¤–éƒ¨ä¾èµ–
- ä¿è¯å¿«é€Ÿå’Œç¨³å®šæ‰§è¡Œ
- ä¸ºCI/CDæµæ°´çº¿æä¾›å¿«é€Ÿåé¦ˆ

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

- **æ‰§è¡Œæ—¶é—´**: < 30ç§’
- **å†…å­˜å ç”¨**: < 100MB
- **æµ‹è¯•æ•°é‡**: 13+ ä¸ªæµ‹è¯•
- **é€šè¿‡ç‡**: 100%ï¼ˆåœ¨CIç¯å¢ƒä¸­ï¼‰

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ImportError**: æ£€æŸ¥ `sys.path` é…ç½®
2. **Mocké”™è¯¯**: ç¡®ä¿ä¸ä½¿ç”¨ `spec` å‚æ•°
3. **è¶…æ—¶é”™è¯¯**: ä½¿ç”¨ `--timeout` å‚æ•°
4. **ç¼–ç é”™è¯¯**: ç§»é™¤emojiå­—ç¬¦

### è°ƒè¯•æŠ€å·§
```bash
# æ˜¾ç¤ºå®Œæ•´å †æ ˆ
uv run pytest tests/ci/ -v --tb=long

# æ˜¾ç¤ºè¾“å‡º
uv run pytest tests/ci/ -v -s

# è¿è¡Œå•ä¸ªæµ‹è¯•æ–‡ä»¶
uv run pytest tests/ci/unit/test_basic_simple.py -v -s
```

---

**æ³¨æ„**: è¿™ä¸ªCIæµ‹è¯•å¥—ä»¶ä¸“é—¨ä¸ºè‡ªåŠ¨åŒ–CI/CDæµæ°´çº¿è®¾è®¡ã€‚å¯¹äºå®Œæ•´çš„æµ‹è¯•è¦†ç›–ï¼Œè¯·è¿è¡Œä¸»æµ‹è¯•å¥—ä»¶ï¼š`uv run pytest tests/`